# AI-NovelFlow

**[简体中文](README.md) | [繁體中文](README_TW.md) | [English](README_EN.md) | [日本語](README_JA.md) | [한국어](README_KO.md)**

AI 기반 소설 동영상 변환 플랫폼

## 프로젝트 개요

NovelFlow는 소설을 자동으로 동영상으로 변환하는 AI 플랫폼입니다.

**핵심 워크플로우:**

```
┌─────────┐    ┌───────────┐    ┌───────────┐    ┌───────────┐
│  소설   │ → │ AI 캐릭터 │ → │ 캐릭터    │ → │ 원문      │
│         │    │  파싱     │    │ 이미지    │    │  내용     │
└─────────┘    └───────────┘    └───────────┘    └───────────┘
                                                         ↓
┌───────────┐    ┌───────────────┐    ┌───────────────┐    ┌───────────────┐
│  동영상   │ ← │  전환         │ ← │  샷           │ ← │  샷           │
│  합성     │    │  동영상 생성  │    │  동영상 생성  │    │  이미지 생성  │
└───────────┘    └───────────────┘    └───────────────┘    └───────┬───────┘
                                                                    ↑
                              ┌───────────────┐    ┌───────────┐    │
                              │ 통합 캐릭터   │ ← │  JSON     │ ← ┘
                              │ 이미지 생성   │    │ 구조      │
                              └───────────────┘    └───────────┘
```

**상세 단계:**
1. **소설** - 신규 생성 또는 소설 텍스트 가져오기
2. **AI 캐릭터 파싱** - 캐릭터 정보 자동 추출 (이름, 설명, 외모)
3. **캐릭터 이미지 생성** - 각 캐릭터에 대해 AI 이미지 생성
4. **원문 내용** - 소설 장 내용 편집
5. **AI 샷 분할** - 장을 샷으로 분할 (장면, 칵메라, 액션)
6. **JSON 구조** - 샷 데이터 생성 (캐릭터, 장면, 샷 설명)
7. **통합 캐릭터 이미지 생성** - 여러 캐릭터를 참조 이미지로 통합
8. **샷 이미지 생성** - 샷 설명에 따라 장면 이미지 생성
9. **샷 동영상 생성** - 샷 이미지를 동영상 클립으로 변환
10. **전환 동영상 생성** - 샷 사이에 전환 동영상 생성 (선택사항)
11. **동영상 합성** - 모든 클립을 완전한 동영상으로 합성

**주요 특징:**
- 장회체 소설 파싱 지원
- 캐릭터 일관성 (여러 장면에서 캐릭터 외모 유지)
- 자동 샷 생성 및 동영상 합성

## 기술 스택

- **프론트엔드**: React + TypeScript + Tailwind CSS + Vite
- **상태 관리**: Zustand (전역 상태 + 국제화/타임존 상태)
- **백엔드**: FastAPI + SQLAlchemy + SQLite
- **AI**: DeepSeek API / OpenAI API / Gemini API + ComfyUI
- **동영상 생성**: LTX-2 동영상 생성 모델
- **국제화**: 커스텀 i18n 구현 (5개 언어 지원)

## 주요 기능

- **소설 관리**: 신규 생성, 편집, 삭제 지원, 자동 장회체 파싱
- **캐릭터 도감**: AI 자동 캐릭터 파싱, 캐릭터 이미지 생성 및 일관성 유지
- **샷 생성**: AI 자동 장 분할, 일괄 이미지 및 동영상 생성 지원
- **전환 동영상**: 칵메라 전환, 라이팅 전환, 오클루전 전환 지원
- **동영상 합성**: 샷 동영상을 장 동영상으로 합성, 자동 전환 삽입
- **워크플로우 관리**: 커스텀 ComfyUI 워크플로우, 노드 매핑 설정
- **작업 큐**: 백그라운드 비동기 작업 처리, 실시간 작업 모니터링
- **프리셋 테스트 케이스**: 「어린 말의 강 걷기」「빨간 모자」「벌거벗은 임금님」등 테스트 케이스 내장
- **다국어 지원**: 간체 중국어, 번체 중국어, 영어, 일본어, 한국어 인터페이스
- **타임존 지원**: 사용자가 타임존을 커스터마이즈 가능, 모든 시간 표시를 지정 타임존으로 변환

## 프로젝트 구조

```
AI-NovelFlow/
├── backend/              # FastAPI 백엔드
│   ├── app/
│   │   ├── api/         # API 라우트
│   │   ├── core/        # 코어 설정
│   │   ├── models/      # 데이터베이스 모델
│   │   ├── schemas/     # Pydantic 모델
│   │   └── services/    # 비즈니스 로직 (LLM, ComfyUI)
│   ├── user_story/      # 생성된 이미지/동영상 저장 디렉토리
│   └── main.py
├── frontend/            # React 프론트엔드
│   └── my-app/
│       ├── src/
│       │   ├── components/  # 컴포넌트
│       │   ├── i18n/        # 국제화 번역 파일
│       │   ├── pages/       # 페이지
│       │   ├── stores/      # 상태 관리
│       │   └── types/       # TypeScript 타입
│       └── package.json
├── windows_gpu_monitor/ # Windows GPU 모니터링 서비스 (선택사항)
│   ├── gpu_monitor.py   # GPU 모니터링 서비스
│   ├── requirements.txt # 의존성
│   └── start.bat        # Windows 시작 스크립트
└── README.md
```

## 빠른 시작

### 백엔드 시작

```bash
cd backend
source venv/bin/activate  # Windows: venv\Scripts\activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

백엔드 서비스는 http://localhost:8000 에서 실행

### 프론트엔드 시작

```bash
cd frontend/my-app
npm install
npm run dev
```

프론트엔드 서비스는 http://localhost:5173 에서 실행

## API 문서

백엔드 시작 후 접속: http://localhost:8000/docs

## 설정 설명

### 1. LLM API 설정

여러 LLM 제공자 지원:
- **DeepSeek** (기본): https://api.deepseek.com
- **OpenAI**: https://api.openai.com
- **Gemini**: https://generativelanguage.googleapis.com
- **Anthropic**: https://api.anthropic.com
- **Azure OpenAI**: 커스텀 Azure 엔드포인트

【시스템 설정】페이지에서 API Key와 프록시를 설정 (필요한 경우).

### 2. ComfyUI 설정

- **ComfyUI 주소**: 기본 http://localhost:8188
- **워크플로우 설정**: 커스텀 워크플로우 업로드 지원, 노드 매핑 필요
  - 캐릭터 생성: 프롬프트 노드 + 이미지 저장 노드
  - 샷 이미지: 프롬프트 노드 + 이미지 저장 노드 + 너비/높이 노드
  - 샷 동영상: 프롬프트 노드 + 동영상 저장 노드 + 참조 이미지 노드
  - 전환 동영상: 첫 프레임 노드 + 마지막 프레임 노드 + 동영상 저장 노드

### 3. Windows GPU 모니터링 (선택사항)

ComfyUI가 원격 Windows 서버에서 실행되는 경우, `windows_gpu_monitor` 서비스를 배포하여 실시간 GPU 상태를 가져올 수 있습니다.

**기능**:
- 실시간 GPU 사용률, 온도, VRAM 모니터링
- 메모리 사용 상황 모니터링
- 큐 작업 수 표시

**배포 단계**:

```bash
cd windows_gpu_monitor

# 의존성 설치
pip install -r requirements.txt

# 서비스 시작
start.bat
```

서비스는 기본적으로 http://localhost:5000 에서 실행

**접속 테스트**:
- 홈: http://localhost:5000/
- GPU 상태: http://localhost:5000/gpu-stats

### 4. 프롬프트 템플릿 설정

커스터마이즈 지원:
- AI 캐릭터 파싱 시스템 프롬프트
- 캐릭터 생성 프롬프트 템플릿
- 장 분할 프롬프트 템플릿

### 5. 국제화 및 타임존 설정

**언어 설정**:
- 간체 중국어 (zh-CN)
- 번체 중국어 (zh-TW)
- English (en-US)
- 日本語 (ja-JP)
- 한국어 (ko-KR)

**타임존 설정**:
- 전 세계 주요 타임존 지원
- 모든 시간 표시 (작업 목록, LLM 로그 등)를 지정 타임존으로 변환
- 백엔드는 UTC 시간을 통일 저장, 프론트엔드는 사용자 설정에 따라 동적 변환

【시스템 설정】→【언어와 타임존】페이지에서 설정.

## 개발 로드맵

- [x] 프로젝트 초기화
- [x] 기본 페이지 (웰컴, 설정, 소설 목록)
- [x] 백엔드 API 프레임워크
- [x] DeepSeek API 통합 (텍스트 파싱)
- [x] ComfyUI API 통합 (이미지/동영상 생성)
- [x] 작업 큐 시스템
- [x] 캐릭터 도감 관리
- [x] 워크플로우 관리 시스템
- [x] JSON 파싱 로그
- [x] 프리셋 테스트 케이스
- [x] 다국어 지원 (중/영/일/한/번체)
- [x] 타임존 지원
- [x] 동영상 합성 기능 (샷 동영상 병합, 전환 삽입 지원)

## 사용 설명

### 1. 소설 신규 생성
- 【소설 생성】을 클릭하여 소설 생성
- 또는 프리셋 테스트 케이스를 선택하여 빠른 체험

### 2. AI 파싱
- 장 페이지에서 【AI 장 분할】을 클릭
- 시스템이 자동으로 캐릭터, 장면, 샷을 파싱

### 3. 캐릭터 이미지 생성
- 【캐릭터】페이지로 들어가기
- 【AI로 모든 캐릭터 이미지 생성】을 클릭

### 4. 샷 이미지 생성
- 【장 생성】페이지로 들어가기
- 【모든 샷 생성】을 클릭

### 5. 샷 동영상 생성
- 샷 이미지 생성이 완료된 후
- 【모든 샷 동영상 생성】을 클릭

### 6. 전환 동영상 생성 (선택사항)
- 샷 사이에 전환 동영상 생성

## License

MIT
